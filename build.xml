<?xml version="1.0"?>

<project name="eSciDoc infrastructure - admin tool build file" default="admin-jar" basedir=".">

	<property file="etc/${user.name}.properties" />
	<property file="etc/project.properties" />

	<path id="build.classpath">
		<pathelement path="${classpath}" />
		<fileset dir="${lib.dir}" includes="**/*.jar" />
	</path>

	<!-- Cleans the output folders -->
	<target name="clean" description="Cleans the output folders">
		<delete includeEmptyDirs="true" failonerror="false">
			<fileset dir="${java.build.dir}" includes="**/*" />
			<fileset dir="${dist.build.dir}" includes="**/*" />
			<fileset dir="${admin.jar.build.dir}" includes="**/*" />
			<fileset dir="${main.jar.build.dir}" includes="**/*" />
		</delete>
	</target>

	<!-- Creates the output folders -->
	<target name="prepare" depends="clean" description="Creates the output folders">
		<mkdir dir="${java.build.dir}" />
		<mkdir dir="${dist.build.dir}" />
		<mkdir dir="${main.jar.build.dir}" />
		<mkdir dir="${admin.jar.build.dir}" />
		<mkdir dir="${admin.jar.main.dir}" />
		<mkdir dir="${admin.jar.lib.dir}" />
	</target>

	<target name="build" depends="clean, prepare, compile">
	</target>

	<!-- Compile -->
	<target name="compile" description="Compile java classes">
		<javac destdir="${java.build.dir}" debug="on">
			<classpath refid="build.classpath" />
			<src path="${java.src.dir}" />
		</javac>
	</target>
	
	<target name="main-jar" depends="build">
		<copy todir="${main.jar.build.dir}">
			<fileset dir="${java.build.dir}" excludes="**/*.class" />
			<fileset dir="${java.build.dir}" includes="de/**/*.class" />
		</copy>
		<delete dir="${main.jar.build.dir}/com" failonerror="false" />

		<jar jarfile="${admin.jar.main.dir}/${main.jar.name}.jar" basedir="${main.jar.build.dir}" />
	</target>

	<target name="admin-jar" depends="main-jar">
		<copy todir="${admin.jar.build.dir}">
			<fileset dir="${java.build.dir}" excludes="**/*.class" />
			<fileset dir="${java.build.dir}" includes="**/*.class" />
		</copy>
		<delete dir="${admin.jar.build.dir}/de" failonerror="false" />
		<copy todir="${admin.jar.lib.dir}">
			<fileset dir="${lib.dir}" includes="**/*" />
		</copy>
		<jar jarfile="${dist.build.dir}/${admin.jar.name}.jar" manifest="${metadata.src.dir}/Manifest.mf">
			<fileset dir="${admin.jar.build.dir}" includes="**/*" />
		</jar>
	</target>



	
	<target name="run">
		<java jar="${dist.dir}/eSciDocCoreAdmin.jar" fork="true">
			<arg value="reindex" />
		</java>
	</target>
</project>
